---
- name: Deploiement de l'application java dans un conteneur Docker présent dans la machine distante
  hosts: all
  become: yes
  
  tasks:
      - name: Installation de Docker dans la machine distante
        shell: amazon-linus-extras install -y docker
        register: result_install
      - debug: result_install
          var=result_install
          
      - name: Envoyer les fichiers helloWorld.class & Dockerfile dans le dossier /app sur la machine distante
        # Création du dossier app
        file:
            path: /app
            state: directory
            mode: 0777
            owner: ec2-user
        # Envoie des fichiers
        copy: 
          src: helloWorld.class
          dest: /app
          mode: 0644
          
        copy: 
          src: Dockerfile
          dest: /app
          mode: 0644
          
      - name: On génère l'image docker, on l'appelle formation/java:1.0
         shell: docker run --rm --name conteneur_app formation/java:1.0
         register: result
      - debug:
           var=result
